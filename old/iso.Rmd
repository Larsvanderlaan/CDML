---
title: "Untitled"
output: html_document
date: '2023-04-12'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r}
cache <- c()
for(i in 1:200) {
n <- 1000
x <- sort(runif(n))
y <- x + rnorm(n, 0, sd = 0.15 ) #+ x^2/3)
 
iso <- as.stepfun(isoreg(x,y))(x)
delta <- 0.1
sigma <- 0.15
 
k <- 500

left <- max(sapply(1:k, function(m){
  mean(iso[(k-m+1):k]) - sqrt(1.96*sigma^2  / m)
}))

right <- min(sapply(1:(n-k+1), function(m){
  mean(iso[k:( k+ m -1)]) + sqrt(1.96*sigma^2  / m)
}))
 print(c(left, x[k], right))
cache <- c(cache, x[k] >= left & x[k] <= right)
print(table(cache))
print(mean(cache))
 
}
 

```
