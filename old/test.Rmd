---
title: "test"
output: html_document
date: '2023-01-04'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(hal9001)
passes <- c()
for(i in 1:1000){
n <- 1001
d <- 2
W <- replicate(d, runif(n, -1, 1))
colnames(W) <- paste0("W", 1:ncol(W))
pi <-  plogis(2*W[,1] )
A <- rbinom(n,1,pi)
tau <- 1 +  abs(W[,1] ) 
Y <- rnorm(n,  W[,2]+W[,1]  + A* tau, 0.2)
ATE <-1.49963

 

#fit_tau <- fit_hal_pcate(W, A, Y, include_propensity_score = FALSE ,max_degree = 2, num_knots = c(15,15))
fit_tau <- fit_hal_pcate(W, A, Y ,max_degree = 2, num_knots = c(10,10),   screen_variables = T)

tau_preds <- predict(fit_tau, W)
plot(sort(W[,1]), tau_preds[order(W[,1])], type = "l")
plot(tau_preds, tau)
out <- inference_cate(fit_tau)
print(as.matrix(out))
pass <- 1*(out$CI_left <=ATE & out$CI_right >= ATE)
passes <- c(passes, pass)
print(mean(passes))
print(as.vector(table(passes)))
}
```

```{r}
 
```
