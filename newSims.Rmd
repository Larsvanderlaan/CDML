---
title: "Untitled"
output: html_document
date: '2023-09-15'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
n <- 1000
W1 <- runif(n, -2 , 2)
W2 <- rbinom(n, 1, 0.5)

A <- rbinom(n, 1, plogis(-W1 + 2 * W1 * W2))
Y <- rbinom(n, 1, plogis(0.2*A - W1 + 2*W1*W2))
ATE <- 0.03803004
library(sl3)
library(drtmle)
 
SuperLearner(A, data.table(W1, W2), SL.library = "SL.kernel")

SL.kernel <- function (Y, X, newX, family = gaussian(), obsWeights = rep(1, 
                                                            length(Y)), rangeThresh = 1e-07, ...) 
{
  options(np.messages = TRUE)
  if (abs(diff(range(Y))) <= rangeThresh) {
    thisMod <- glm(Y ~ 1, data = X)
  }
  else {
    bw <- np::npregbw(stats::as.formula(paste("Y ~", paste(names(X), 
                                                           collapse = "+"))), data = X, ftol = 0.01, tol = 0.01, 
                      remin = FALSE)
    thisMod <- np::npreg(bw)
  }
  pred <- stats::predict(thisMod, newdata = newX)
  fit <- list(object = thisMod)
  class(fit) <- "SL.npreg"
  out <- list(pred = pred, fit = fit)
  return(out)
}



```
